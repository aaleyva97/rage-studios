<p-toast />
<nav class="topbar">
  <div class="topbar-container">
    <!-- Mobile: Hamburger menu on left -->
    <p-button 
      icon="pi pi-bars" 
      severity="secondary" 
      [text]="true"
      size="large"
      class="md:hidden"
      (onClick)="toggleMobileMenu()"
      [attr.aria-expanded]="mobileMenuVisible()"
      [attr.aria-controls]="mobileMenuVisible() ? 'mobile-menu-drawer' : null">
    </p-button>
    
    <!-- Desktop: Left navigation items -->
    <div class="nav-section-left">
      @for (item of leftMenuItems(); track item.routerLink || item.sectionId) {
        @if (item.action === 'scroll') {
          <a (click)="onNavItemClick(item, $event)" class="nav-item cursor-pointer">
            <span>{{ item.label }}</span>
            <div class="nav-underline"></div>
          </a>
        } @else {
          <a [routerLink]="item.routerLink" class="nav-item">
            <span>{{ item.label }}</span>
            <div class="nav-underline"></div>
          </a>
        }
      }
    </div>
    
    <!-- Center: Logo -->
    <div class="logo">
      <span class="logo-text">RAGE STUDIOS</span>
    </div>
    
    <!-- Desktop: Right navigation items -->
    <div class="nav-section-right">
      @for (item of rightMenuItems(); track item.routerLink || item.sectionId) {
        @if (item.action === 'scroll') {
          <a (click)="onNavItemClick(item, $event)" class="nav-item cursor-pointer">
            <span>{{ item.label }}</span>
            <div class="nav-underline"></div>
          </a>
        } @else {
          <a [routerLink]="item.routerLink" class="nav-item">
            <span>{{ item.label }}</span>
            <div class="nav-underline"></div>
          </a>
        }
      }
      
      @if (!isLoggedIn()) {
        <p-button 
          label="Iniciar Sesión" 
          severity="primary" 
          size="small"
          (onClick)="openLoginDialog()"
          styleClass="ml-4">
        </p-button>
      } @else {
         <!-- Badge de créditos -->
        <div class="credits-badge" pTooltip="{{ getCreditsTooltip() }}" tooltipPosition="bottom">
          <p-overlaybadge 
            [value]="creditsService.getCreditsDisplay()" 
            severity="success"
            styleClass="credits-overlay-badge">
            <i class="pi pi-wallet text-xl text-gray-600"></i>
          </p-overlaybadge>
        </div>
        <!-- User section with dropdown -->
        <div class="user-section">
          <p-button 
            [label]="getUserDisplayName()" 
            [text]="true"
            icon="pi pi-chevron-down"
            iconPos="right"
            (onClick)="toggleUserMenu($event)"
            class="btn-user">
          </p-button>
          <p-menu 
            #userMenu
            [model]="userMenuItems()"
            [popup]="true"
            appendTo="body">
          </p-menu>
        </div>
      }
    </div>
    
    <!-- Mobile: Right action button -->
    <div class="mobile-action-button">
      @if (!isLoggedIn()) {
        <p-button 
          icon="pi pi-user" 
          severity="secondary" 
          [text]="true"
          size="large"
          class="md:hidden"
          (onClick)="openLoginDialog()">
        </p-button>
      } @else {
        <div class="flex gap-2 items-center">
          <p-button 
          icon="pi pi-calendar" 
          severity="secondary" 
          [text]="true"
          size="large"
          class="md:hidden"
          routerLink="/reservar">
        </p-button>
        <div class="mobile-credits-container">
          <p-overlaybadge 
            [value]="creditsService.getCreditsDisplay()" 
            severity="success"
            styleClass="mobile-credits-badge">
            <i class="pi pi-wallet text-lg"></i>
          </p-overlaybadge>
        </div>
        </div>
      }
    </div>
  </div>
</nav>

<p-drawer 
  [(visible)]="mobileMenuVisible" 
  position="right"
  id="mobile-menu-drawer"
  styleClass="!w-full sm:!w-80"
  (onHide)="closeMobileMenu()">
  
  <ng-template #header>
    <div class="flex justify-end w-full"></div>
  </ng-template>
  
  <div class="flex flex-col gap-6 pt-4 px-6 items-center">
    @for (item of leftMenuItems(); track item.routerLink || item.sectionId) {
      @if (item.action === 'scroll') {
        <a 
          (click)="onNavItemClick(item, $event)"
          class="mobile-nav-item cursor-pointer">
          <span>{{ item.label }}</span>
        </a>
      } @else {
        <a 
          [routerLink]="item.routerLink" 
          class="mobile-nav-item"
          (click)="onMenuItemClick()">
          <span>{{ item.label }}</span>
        </a>
      }
    }
    @for (item of rightMenuItems(); track item.routerLink || item.sectionId) {
      @if (item.action === 'scroll') {
        <a 
          (click)="onNavItemClick(item, $event)"
          class="mobile-nav-item cursor-pointer">
          <span>{{ item.label }}</span>
        </a>
      } @else {
        <a 
          [routerLink]="item.routerLink" 
          class="mobile-nav-item"
          (click)="onMenuItemClick()">
          <span>{{ item.label }}</span>
        </a>
      }
    }
    
    <div class="pt-4 mt-4 border-t border-gray-200 w-full">
      @if (!isLoggedIn()) {
        <p-button 
          label="Iniciar Sesión" 
          severity="primary" 
          size="small"
          class="w-full"
          (onClick)="onLoginFromMobile()">
        </p-button>
      } @else {
        <div class="flex flex-col gap-3">
          <div class="text-center py-2">
            <span class="text-sm text-gray-600">Bienvenido,</span>
            <div class="font-medium text-gray-900">{{ getUserDisplayName() }}</div>
          </div>
          <p-button 
            label="Cerrar Sesión" 
            severity="secondary" 
            size="small"
            class="w-full"
            [outlined]="true"
            icon="pi pi-sign-out"
            (onClick)="onLogoutFromMobile()">
          </p-button>
        </div>
      }
    </div>
  </div>
</p-drawer>

<app-login-dialog 
  [(visible)]="showLoginDialog" 
  (openRegister)="onOpenRegisterFromLogin()">
</app-login-dialog>

<app-register-dialog 
  [(visible)]="showRegisterDialog" 
  (openLogin)="onOpenLoginFromRegister()">
</app-register-dialog>