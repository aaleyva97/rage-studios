<p-toast />
<p-confirm-dialog />

<div class="my-bookings-container">
  <h2 class="text-2xl font-bold mb-4">Mis Reservas</h2>
  
  @if (!isLoading() && bookings().length === 0) {
    <div class="text-center py-8">
      <i class="pi pi-calendar text-5xl text-gray-300 mb-4"></i>
      <p class="text-gray-500">No tienes reservas</p>
    </div>
  } @else {
    <p-table 
      [value]="isLoading() ? skeletonData : bookings()"
      [rows]="10"
      [paginator]="true"
      [tableStyle]="{ 'min-width': '50rem' }"
      [rowHover]="true"
      dataKey="id"
      currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} reservas"
      [showCurrentPageReport]="true"
      [rowsPerPageOptions]="[10, 20, 30]"
      class="p-datatable-gridlines">
      
      <ng-template pTemplate="header">
        <tr>
          <th>Fecha</th>
          <th>Hora</th>
          <th>Coach</th>
          <th>Camas</th>
          <th>Acompañantes</th>
          <th>Créditos</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </ng-template>
      
      <ng-template pTemplate="body" let-booking>
        @if (isLoading()) {
          <tr>
            <td><p-skeleton width="80%" /></td>
            <td><p-skeleton width="60%" /></td>
            <td><p-skeleton width="70%" /></td>
            <td><p-skeleton width="50%" /></td>
            <td><p-skeleton width="30%" /></td>
            <td><p-skeleton width="40%" /></td>
            <td><p-skeleton width="60%" /></td>
            <td class="flex gap-2">
              <p-skeleton width="2.5rem" height="2.5rem" shape="circle" />
            </td>
          </tr>
        } @else {
          <tr>
            <td>{{ booking.formattedDate }}</td>
            <td>{{ booking.formattedTime }}</td>
            <td>{{ booking.coach_name }}</td>
            <td>{{ booking.bed_numbers.join(', ') }}</td>
            <td>{{ booking.attendees.length || 0 }}</td>
            <td>{{ booking.credits_used }}</td>
            <td>
              <p-tag 
                [value]="booking.statusLabel"
                [severity]="booking.statusSeverity"
                [rounded]="true">
              </p-tag>
            </td>
            <td>
              @if (booking.canCancel) {
                <p-button 
                  icon="pi pi-times" 
                  severity="danger"
                  [text]="true"
                  [rounded]="true"
                  size="small"
                  pTooltip="Cancelar reserva"
                  (onClick)="confirmCancelBooking(booking)">
                </p-button>
              } @else {
                <p-tag 
                  value="No cancelable" 
                  severity="secondary"
                  [rounded]="true">
                </p-tag>
              }
            </td>
          </tr>
        }
      </ng-template>
    </p-table>
  }
</div>